version: '3.8'

services:
  app:
    # 1. 베이스 이미지: Gradle과 JDK 21이 설치된 이미지 사용
    #    (이 이미지는 amd64/arm64 모두 지원합니다)
    image: gradle:8-jdk21

    # 2. 컨테이너 내부의 작업 디렉토리
    working_dir: /app

    # 3. 포트 연결 (호스트:컨테이너)
    ports:
      - "8080:8080" # Spring Boot 포트
      # - "5005:5005" # 원격 디버깅 포트 (필요시 주석 해제)

    # 4. 볼륨 마운트
    #    - 호스트의 현재 코드를 컨테이너의 /app으로 연결 (자동 리로드 핵심)
    #    - Gradle 캐시를 볼륨으로 유지해 빌드 속도 향상
    env_file:
      - .env

    volumes:
      - .:/app
      - gradle-cache:/home/gradle/.gradle

    # 5. 실행 명령어 (Gradle wrapper로 bootRun 실행)
    #    Spring Boot DevTools가 변경을 감지하고 자동 재시작
    command: ./gradlew bootRun

    # 6. 원격 디버깅을 위한 환경 변수 (필요시 주석 해제)
    # environment:
    #   - JAVA_OPTS=-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=*:5005

# Gradle 캐시 볼륨 정의
volumes:
  gradle-cache: